# Contributor:
# Maintainer: Tristan IsraÃ«l <tristan.israel@alefbet.net>
pkgname=psec-container-debian
pkgver=1.0
pkgrel=1
pkgdesc="PSEC - LXC Container based on Debian"
url="https://www.alefbet.net/"
arch="x86_64"
license="MIT"
depends="lxc lxc-download lxc-templates lxc-bridge iptables"
makedepends=""
builddir="$srcdir/$pkgname-$pkgver"
checkdepends=""
install="$pkgname.post-install $pkgname.pre-deinstall"
subpackages=""
replaces=""
options="!check"  # no tests provided
#_distro="debian"
#_release="buster"
#_arch="amd64"
source="
https://www.alefbet.net/github/psec/x86_64/lxc-container-debian.tar.bz2!
"

#build() {     
    # The container has been previously created
    # Create a new container
    # sudo lxc-create -n "$pkgname" -t download -P "$srcdir" -- --dist $_distro --release $_release --arch $_arch

    # Disable networking in the container
    # sudo sed -i 's/^lxc\.net/#&/' "$srcdir/$pkgname"/config

    # sudo lxc-stop "$pkgname"
#}

prepare() {
    default_prepare
}

package() {
    mkdir -p "$pkgdir"/var/lib/lxc/

    # Tar container
    #sudo tar cf "$pkgdir"/var/lib/lxc/"$pkgname".tar -C "$srcdir" .
    #sudo chown $USER "$pkgdir"/var/lib/lxc/"$pkgname".tar

    # Compress archive
    #bzip2 "$pkgdir"/var/lib/lxc/"$pkgname".tar

    # Copy the archive into the package
    mv $srcdir/lxc-container-debian.tar.bz2 $pkgdir/var/lib/lxc

    # Clean the environment because abuild won't be able
    sudo rm -rf "$srcdir/$pkgname"
}
