# Contributor:
# Maintainer: Tristan Isra..l <tristan.israel@alefbet.net>
pkgname=psec-lib
pkgver=1.2
pkgrel=0
pkgdesc="PSEC - Python library"
url="https://www.alefbet.net/"
arch="noarch"
license="MIT"
depends="python3 py3-evdev py3-pyserial py3-paho-mqtt2 py3-udev py3-msgpack py3-psutil"
makedepends="python3-dev py3-build py3-installer git"
builddir="$srcdir/$pkgname-$pkgver"
checkdepends=""
install=""
subpackages=""
replaces=""
options="!check"  # no tests provided
source="
$pkgname.zip::https://github.com/TristanIsrael/PSEC/archive/refs/heads/$gitbranch.zip
"

PSEC_CONFDIR="$pkgdir/etc/psec"
PSEC_ROOTDIR="$pkgdir/usr/lib/psec"
PSEC_BINDIR="$PSEC_ROOTDIR/bin"

prepare() {
    default_prepare()
    #mkdir -p "$builddir"
    #echo "Uncompress source files"
    #unzip $pkgname.zip -d "$builddir"    
}

build() {
    cd "$gitrepo-$gitbranch/python/lib"
    python3 -m build
    ls -l
}

package() {
    ls -l src
    ls -lR src/$gitrepo-$gitbranch
    cd "src/$gitrepo-$gitbranch/python/lib/dist"
    ls -l
    python3 -m installer --destdir=$pkgdir psec-*-py3-none-any.whl
}
