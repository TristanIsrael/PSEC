# Contributor:
# Maintainer: Tristan IsraÃ«l <tristan.israel@alefbet.net>
pkgname=psec-sys-usb
pkgver=1.0
pkgrel=5
pkgdesc="PSEC - USB proxy virtual machine"
url="https://www.alefbet.net/"
arch="noarch"
license="MIT"
depends="psec-lib ntfs-3g eudev"
makedepends="python3-dev py3-build py3-installer git"
builddir="$srcdir/$pkgname-$pkgver"
checkdepends=""
install="$pkgname.post-install"
subpackages=""
replaces="mdev-conf alpine-baselayout-data"
options="!check"  # no tests provided
source="modules
psec-sys-usb-controller.initd
notify-disk-added.py
notify-disk-removed.py
mdev-usb-storage
99-usbdisks.rules
psec-sys-usb-controller.py"

PSEC_CONFDIR="/etc/psec"
PSEC_ROOTDIR="/usr/lib/psec"
PSEC_BINDIR="$PSEC_ROOTDIR/bin"

package() {
    install -D -m644 "$srcdir"/modules "$pkgdir/etc/modules"
    install -D -m644 "$srcdir"/notify-disk-added.py "$pkgdir/$PSEC_BINDIR/notify-disk-added.py"
    install -D -m644 "$srcdir"/notify-disk-removed.py "$pkgdir/$PSEC_BINDIR/notify-disk-removed.py"
    install -D -m755 "$srcdir"/mdev-usb-storage "$pkgdir/$PSEC_BINDIR"/mdev-usb-storage
    install -D -m755 "$srcdir"/99-usbdisks.rules "$pkgdir"/etc/udev/rules.d/99-usbdisks.rules
    install -D -m755 "$srcdir"/psec-sys-usb-controller.initd "$pkgdir"/etc/init.d/psec-sys-usb-controller
    install -D -m644 "$srcdir"/psec-sys-usb-controller.py "$pkgdir/$PSEC_BINDIR/psec-sys-usb-controller.py
}
