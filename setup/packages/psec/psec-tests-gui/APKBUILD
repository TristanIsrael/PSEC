# Contributor:
# Maintainer: Tristan IsraÃ«l <tristan.israel@alefbet.net>
pkgname=psec-tests-gui
pkgver=1.0
pkgrel=0
pkgdesc="PSEC - Test tool GUI"
url="https://www.alefbet.net/"
arch="noarch"
license="MIT"
depends="python3 py3-pyside6 fontconfig freetype font-roboto"
makedepends="python3-dev py3-build py3-installer git"
builddir="$srcdir/$pkgname-$pkgver"
checkdepends=""
install="$pkgname.post-install"
subpackages=""
replaces=""
options="!check"  # no tests provided
gitbranch="main"
source="
$pkgname.zip::https://github.com/TristanIsrael/PSEC/archive/refs/heads/$gitbranch.zip
tests.initd
"

prepare() {
    mkdir -p "$builddir"
    echo "Uncompress source files"
    unzip $pkgname.zip -d "$builddir"    
}

build() {
    cd "$builddir/PSEC/python/tests"
    python3 -m build
}

package() {
    cd "$builddir/python/tests/dist"
    mkdir -p "$pkgdir/usr/lib/psec"
    tar xvzf *.tar.gz -C "$pkgdir/usr/lib/psec"
    cd "$pkgdir/usr/lib/psec"
    ln -s "tests-$pkgver" tests    

    install -D -m755 "$srcdir"/tests.initd "$pkgdir/etc/init.d/tests"
}
